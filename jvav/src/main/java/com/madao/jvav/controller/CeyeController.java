package com.madao.jvav.controller;


import com.madao.jvav.pojo.Ceye;
import com.madao.jvav.util.Function;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.client.RestTemplate;

@CrossOrigin
@RestController

public class CeyeController {
    @Autowired
    private Ceye ceye;

    @RequestMapping(value = "/ceye",produces = "application/json;charset=utf-8")
    public String getCeyeData(@RequestParam("id") String randomId) {
        String token = ceye.getToken();
        String url = "http://api.ceye.io/v1/records?token=" + token + "&type=dns&filter=" + randomId;
        RestTemplate restTemplate = new RestTemplate();
        String ceyeResp = restTemplate.getForObject(url, String.class);
        try {
            return ceyeResp;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    @GetMapping("/domain")
    public String getDomain() {
        String id = Function.randomId();
        String domain = id + "." + ceye.getIdentifier();
        return domain;
    }
}
